<!doctype html>

<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width">
	<title>IT-ферма</title>
	<link rel="stylesheet" href="style.css">
	<script src="js/jquery-3.7.1.slim.min.js"></script>
	<script src="js/highcharts.js"></script>
</head>

<body>
	<header></header>
	<div class="wrap">
		<div class="menu-btn"><svg id="Layer_1" version="1.1" viewBox="0 0 512 512" xml:space="preserve"
				xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
				<g>
					<g>
						<path class="st0"
							d="M381,190.9H131c-11,0-20-9-20-20s9-20,20-20h250c11,0,20,9,20,20S392,190.9,381,190.9z" />
					</g>
					<g>
						<path class="st0"
							d="M381,361.1H131c-11,0-20-9-20-20s9-20,20-20h250c11,0,20,9,20,20S392,361.1,381,361.1z" />
					</g>
					<g>
						<path class="st0"
							d="M381,276H131c-11,0-20-9-20-20s9-20,20-20h250c11,0,20,9,20,20S392,276,381,276z" />
					</g>
				</g>
			</svg></div>
		<div class="menu">

			<nav class="menu-list">
				<div id="main-page">Главная</div>
				<div id="scheme-page">Устройство</div>
				<div id="data-page">Данные</div>
				<div id="about-us-page">О нас</div>
			</nav>
		</div>
		<div class="content">
			<div class="content-page main__page" id="main__page">
				<div class="tables__body">
					<div class="tables__element box_shadow">
						<table class="temp_table">
							<caption>Температура</caption>
							<tr>
								<th class="table_first">№</th>
								<th>Емкость</th>
								<th class="table_last">Температура</th>
							</tr>
							<tr>
								<td class="table_first">1</td>
								<td>1 емкость</td>
								<td><span id="temp_1"></span>°C</td>
							</tr>
							<tr>
								<td class="table_first">2</td>
								<td>2 емкость</td>
								<td><span id="temp_2"></span>°C</td>
							</tr>
							<tr>
								<td class="table_first">3</td>
								<td>3 емкость</td>
								<td><span id="temp_3"></span>°C</td>
							</tr>
						</table>
						<!-- <input type="button" id="temp_button" class="button" value="Обновить"> -->
					</div>
					<div class="tables__element box_shadow">
						<table class="ph_table">
							<caption>Кислотность</caption>
							<tr>
								<th class="table_first">№</th>
								<th>Емкость</th>
								<th class="table_last">Кислотность</th>
							</tr>
							<tr>
								<td class="table_first">1</td>
								<td>1 емкость</td>
								<td><span id="ph_1"></span></td>
							</tr>
							<tr>
								<td class="table_first">2</td>
								<td>2 емкость</td>
								<td><span id="ph_2"></span></td>
							</tr>
							<tr>
								<td class="table_first">3</td>
								<td>3 емкость</td>
								<td><span id="ph_1"></span></td>
							</tr>
						</table>
						<!-- <input type="button" id="ph_button" class="button" value="Обновить"> -->
					</div>



				</div>
				<div class="relay__set">
					<div class="pump__set relay__set__el box_shadow">
						<span>Насосы</span>
						<div class="relay__element">
							<span class="relay__name">Насос 1</span>
							<input type="button" id="relay_button_0" class="relay_off" />
						</div>
						<div class="relay__element">
							<span class="relay__name">Насос 2</span>
							<input type="button" id="relay_button_1" class="relay_off" />
						</div>
						<div class="relay__element">
							<span class="relay__name">Насос 3</span>
							<input type="button" id="relay_button_2" class="relay_off" />
						</div>
					</div>
					<div class="light__set relay__set__el box_shadow">
						<span>Освещение</span>
						<div class="relay__element">
							<span class="relay__name">Свет 1</span>
							<input type="button" id="relay_button_3" class="relay_off" />
						</div>
						<div class="relay__element">
							<span class="relay__name">Свет 2</span>
							<input type="button" id="relay_button_4" class="relay_off" />
						</div>
						<div class="relay__element">
							<span class="relay__name">Свет 3</span>
							<input type="button" id="relay_button_5" class="relay_off" />
						</div>
					</div>

				</div>

			</div>
			<div class="content-page scheme__page">
				<h1>Устройство фермы</h1>

				<div class="scheme-text">
					<img class="scheme-img" src="scheme.jpeg" alt="">
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Система аквакультуры представляет собой 4 емкости по 1,5 м3 соединенные
						между собой посредством основных циркуляционных труб диаметром 90 мм.</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;В каждую емкость подведена циркуляционная труба для подачи воды и сбора
						воды с установленными кранами переключения. Для полной циркуляции (штатный режим работы системы)
						все краны должны быть открыты.</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Для дренажной системы (система слива отработанной воды) использованы
						трубы диаметром 32 мм. Для полной циркуляции (штатный режим работы системы) все краны должны
						быть закрыты.</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Фильтрация воды осуществялется посредством песочного фильтра,
						протеинового фильтра и биофильтра.</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Биофильтр - это важный элемент оборудования, функция которого заключается
						в очистке системы от вредных для гидробионтов веществ. Песочный фильтр не удаляет все
						органические вещества, самые мелкие частицы проходят сквозь него так же, как и растворенные
						вещества, такие как фосфат или азот.</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Для подачи чистой воды в систему необходимо: <br>
						1) Открыть кран<br>
						2) Включить насос подачи воды<br>
						3) Наполнить воду в системе до достаточного урових<br>
						4) Выключить насос<br>
						5) Закрыть кран подачи воды</p>
					<p>&nbsp;&nbsp;&nbsp;&nbsp;Для подачи раствора для растений необходимо открыть растворный кран на
						биофильтре и кран подачи раствора на соответствующей гидропонной установке.</p>
				</div>
			</div>
			<div class="content-page data__page" id="data__page">
				<div id="chart-temperature" class="container"></div>
			</div>
			<div class="content-page about-us__page">
				<h1>О наc и нашей миссии</h1>
				<p class="about-us_text">Наша миссия: <br> 
					&nbsp;&nbsp;&nbsp;&nbsp;Создание инновационной фермы, где мы используем передовые информационные технологии для устойчивого и эффективного выращивания рыбы и растений без отходов. Мы стремимся к обеспечению высококачественных, экологически чистых продуктов, используя цифровые решения для минимизации отходов и оптимизации производства. Наша цель - создать устойчивую среду, где IT и сельское хозяйство сочетаются для производства пищевых продуктов без отрицательного воздействия на окружающую среду.</p>
				<p class="about-us_text">Наши цели: <br>
					&nbsp;&nbsp;&nbsp;&nbsp;Организовать производство, которое минимизирует отходы, применяя гидропонические инновации для одновременного выращивания рыбы и растений с помощью современного программного обеспечения.</p>
				<p class="about-us_text">Достижения: <br>
					&nbsp;&nbsp;&nbsp;&nbsp;Наши заслуги включают в себя победу на конкурсе, организованном "Olzha agro", где мы представляли наш проект по созданию IT-фермы и выйграли сертификат на 2.500.000 тенге.</p>
				
				<h2>Наша команда</h2>
				<img src="photo_team.jpg" alt="">
			</div>
		</div>


	</div>

	<script>
		var relay_quantity = 3; // количество реле
		var relay_1 = document.getElementById("relay_button_1");
		// var relay_1 = document.getElementById("relay_button_2");
		// var relay_3 = document.getElementById("relay_button_3");
		// var relay_4 = document.getElementById("relay_button_4");
		// var relay_5 = document.getElementById("relay_button_5");
		// var relay_6 = document.getElementById("relay_button_6");
		var relay_status = [];
		let relay = [];

		for (let i = 0; i < relay_quantity; i++) {
			let relay_id = "relay_button_" + i;
			relay.push(document.getElementById(relay_id));
			relay_status.push(0);
		}
		console.log(relay);
		function relay_state(i) {
			var request = new XMLHttpRequest();
			request.open('GET', '/relay_status?val=' + i, true);
			request.onload = function () {
				if (request.readyState == 4 && request.status == 200) {
					var response = request.responseText;
					relay_status[i] = Number.parseInt(response);
					if (response == '0') {
						relay[i].classList.remove('relay_on');
						relay[i].classList.add('relay_off');
						console.log(response);
					} else {
						relay[i].classList.remove('relay_off');
						relay[i].classList.add('relay_on');
						console.log(response);
					}

				}
			}
			request.send();
		}
		function relay_inverse(i) {
			var request = new XMLHttpRequest();
			request.open('GET', '/relay_switch?val=' + i, false);
			request.send();
			if (request.readyState == 4 && request.status == 200) {
				var response = request.responseText;
				if (response == '0') {

					relay[i].classList.remove('relay_on');
					relay[i].classList.add('relay_off');
					relay_status[i] = 0;
				} else {
					relay[i].classList.remove('relay_off');
					relay[i].classList.add('relay_on');
					relay_status[i] = 1;
				}
			}
		}

		function get_temp() {
			var request = new XMLHttpRequest();
			request.open('GET', '/check_temp', false);
			request.send();
			if (request.readyState == 4 && request.status == 200) {
				var response = request.responseText;
				document.getElementById('temp_1').innerHTML = response;
			}
		}

		document.addEventListener('DOMContentLoaded', function () {  // как только страница загрузится начинаем запрашивать данные 
			for (let i = 0; i < relay_quantity; i++) {
				relay_state(i);
			}

		});

		for (let i = 0; i < relay_quantity; i++) {
			relay[i].addEventListener('click', function () {
				relay_inverse(i);
			});
		}
		// функционал по переключению между вкладками___________________________________________
		
		var intervalData = setInterval(getTempChart, 5000);

		$('.menu-btn').on('click', function () {	// килкаем на 'бургер' - выезжает меню
			$('.menu').toggleClass('menu_active');
			$('.content').toggleClass('content_active');
		})

		$('#main-page').on('click', function () {
			$('.content-page').css('display', 'none');
			$('.main__page').css('display', 'block');
		})
		$('#scheme-page').on('click', function () {
			$('.content-page').css('display', 'none');
			$('.scheme__page').css('display', 'block');
		})
		$('#data-page').on('click', function () {
			$('.content-page').css('display', 'none');
			$('.data__page').css('display', 'block');
		})
		$('#about-us-page').on('click', function () {
			$('.content-page').css('display', 'none');
			$('.about-us__page').css('display', 'block');
		})

		

		var chartT = new Highcharts.Chart({
			chart: { renderTo: 'chart-temperature' },
			title: { text: 'Temperature' },
			time: {	timezoneOffset: -360 },
			series: [{
				showInLegend: false,
				data: []
			}],
			plotOptions: {
				line: {
					animation: false,
					dataLabels: { enabled: true }
				},
				series: { color: '#059e8a' }
			},
			xAxis: {
				type: 'datetime',
				dateTimeLabelFormats: { second: '%H:%M:%S' }
			},
			yAxis: {
				title: { text: 'Temperature (Celsius)' }
				//title: { text: 'Temperature (Fahrenheit)' }
			},
			credits: { enabled: false }
		});

		
		function getTempChart() {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					var response = this.responseText;
					document.getElementById('temp_1').innerHTML = response;
					var x = (new Date()).getTime(),
						y = parseFloat(response);
					if (chartT.series[0].data.length > 40) {
						chartT.series[0].addPoint([x, y], true, true, true);
					} else {
						chartT.series[0].addPoint([x, y], true, false, true);
					}
				}
			};
			xhttp.open("GET", "/check_temp", true);
			xhttp.send();
		}
		
	
	</script>
</body>

</html>